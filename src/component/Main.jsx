import React, { useContext } from 'react';
import { Context } from './Context';
import ReactMarkdown from 'react-markdown';

function Main() {
    const { 
        prevPrompts,
        setPrevPrompts,
        sentRequest,
        setRecentPrompt,
        recentPrompt,
        showResult,
        setShowResult,
        loading,
        resultData,
        input,
        setInput 
    } = useContext(Context);

    const handleRequest = async () => {
        setRecentPrompt(input);

        // Clear the input field
        setInput('');
        try {
            await sentRequest();
        } catch (error) {
            console.error("Error fetching data:", error);
        }
    }

    return (
        <div className='w-full h-screen flex flex-1 flex-col relative overflow-hidden'>
            <nav className='p-4 md:p-6 flex items-center gap-2 cursor-pointer'>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" className='fill-black w-[30px]'>
                    <path d="M 23.828125 5.3066406 C 20.368125 5.3066406 17.308969 7.0101875 15.417969 9.6171875 L 15.417969 25.722656 L 19.431641 27.980469 L 19.298828 16.128906 C 19.294828 15.770906 19.484922 15.437859 19.794922 15.255859 L 30.957031 8.71875 C 29.211031 6.58075 26.616125 5.3066406 23.828125 5.3066406 z M 35.082031 8.6191406 L 21.306641 16.685547 L 21.357422 21.298828 L 31.554688 15.257812 C 31.862687 15.075812 32.242687 15.070141 32.554688 15.244141 L 43.828125 21.585938 C 44.776125 19.021937 44.567406 16.150578 43.191406 13.767578 C 41.800406 11.359578 39.555141 9.6360156 36.869141 8.9160156 C 36.277141 8.7570156 35.680031 8.6711406 35.082031 8.6191406 z M 13.416016 13.345703 C 10.629016 13.772703 8.2333594 15.394703 6.8183594 17.845703 C 5.4273594 20.253703 5.0573437 23.058141 5.7773438 25.744141 C 5.9493437 26.387141 6.200375 26.992125 6.484375 27.578125 L 20.285156 35.339844 L 24.255859 32.988281 L 13.925781 27.177734 C 13.611781 27.000734 13.416016 26.667641 13.416016 26.306641 L 13.416016 13.345703 z M 32.076172 17.273438 L 28.105469 19.625 L 38.435547 25.435547 C 38.749547 25.613547 38.945312 25.945641 38.945312 26.306641 L 38.945312 39.251953 C 41.703313 38.827953 44.133922 37.211531 45.544922 34.769531 C 46.935922 32.361531 47.305937 29.555141 46.585938 26.869141 C 46.412937 26.226141 46.161953 25.619203 45.876953 25.033203 L 32.076172 17.273438 z M 26.117188 20.802734 L 21.382812 23.607422 L 21.445312 29.111328 L 26.242188 31.810547 L 30.978516 29.005859 L 30.917969 23.501953 L 26.117188 20.802734 z M 32.931641 24.634766 L 33.064453 36.484375 C 33.068453 36.840375 32.880219 37.173469 32.574219 37.355469 L 21.460938 43.957031 C 23.204937 46.058031 25.762203 47.308594 28.533203 47.308594 C 31.993203 47.308594 35.054313 45.604047 36.945312 42.998047 L 36.945312 26.892578 L 32.931641 24.634766 z M 8.5371094 31.029297 C 7.5881094 33.593297 7.791875 36.454703 9.171875 38.845703 C 10.562875 41.253703 12.806188 42.975313 15.492188 43.695312 C 16.144188 43.870312 16.803891 43.958859 17.462891 44.005859 L 31.056641 35.929688 L 31.005859 31.314453 L 20.808594 37.355469 C 20.651594 37.448469 20.475828 37.496094 20.298828 37.496094 C 20.129828 37.496094 19.960594 37.452188 19.808594 37.367188 L 8.5371094 31.029297 z"></path>
                </svg>
                <h1 className='text-xl font-semibold'>ChatAI</h1>
            </nav>

            {!showResult ? 
                <div className='m-auto text-3xl md:text-5xl font-semibold'>
                    <h2 className='bg-clip-text text-transparent bg-gradient-to-r from-indigo-500 from-10% via-sky-500 via-30% to-emerald-500 to-90% block'>Hello, Tarun.</h2>
                    <p className='text-gray-400'>How can I help you today?</p>
                </div>
                :
                <div className='p-[5%] md:p-[10%] flex flex-col items-end custom-scrollbar overflow-y-scroll'>
                    <div className='my-3 px-6 py-2 bg-gray-300 rounded-full'>
                        <p>{recentPrompt}</p>
                    </div>
                    <div className='pb-[200px] md:pb-[100px] self-start flex flex-col justify-start items-start gap-2'>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" className='fill-black w-[30px]'>
                            <path d="M 23.828125 5.3066406 C 20.368125 5.3066406 17.308969 7.0101875 15.417969 9.6171875 L 15.417969 25.722656 L 19.431641 27.980469 L 19.298828 16.128906 C 19.294828 15.770906 19.484922 15.437859 19.794922 15.255859 L 30.957031 8.71875 C 29.211031 6.58075 26.616125 5.3066406 23.828125 5.3066406 z M 35.082031 8.6191406 L 21.306641 16.685547 L 21.357422 21.298828 L 31.554688 15.257812 C 31.862687 15.075812 32.242687 15.070141 32.554688 15.244141 L 43.828125 21.585938 C 44.776125 19.021937 44.567406 16.150578 43.191406 13.767578 C 41.800406 11.359578 39.555141 9.6360156 36.869141 8.9160156 C 36.277141 8.7570156 35.680031 8.6711406 35.082031 8.6191406 z M 13.416016 13.345703 C 10.629016 13.772703 8.2333594 15.394703 6.8183594 17.845703 C 5.4273594 20.253703 5.0573437 23.058141 5.7773438 25.744141 C 5.9493437 26.387141 6.200375 26.992125 6.484375 27.578125 L 20.285156 35.339844 L 24.255859 32.988281 L 13.925781 27.177734 C 13.611781 27.000734 13.416016 26.667641 13.416016 26.306641 L 13.416016 13.345703 z M 32.076172 17.273438 L 28.105469 19.625 L 38.435547 25.435547 C 38.749547 25.613547 38.945312 25.945641 38.945312 26.306641 L 38.945312 39.251953 C 41.703313 38.827953 44.133922 37.211531 45.544922 34.769531 C 46.935922 32.361531 47.305937 29.555141 46.585938 26.869141 C 46.412937 26.226141 46.161953 25.619203 45.876953 25.033203 L 32.076172 17.273438 z M 26.117188 20.802734 L 21.382812 23.607422 L 21.445312 29.111328 L 26.242188 31.810547 L 30.978516 29.005859 L 30.917969 23.501953 L 26.117188 20.802734 z M 32.931641 24.634766 L 33.064453 36.484375 C 33.068453 36.840375 32.880219 37.173469 32.574219 37.355469 L 21.460938 43.957031 C 23.204937 46.058031 25.762203 47.308594 28.533203 47.308594 C 31.993203 47.308594 35.054313 45.604047 36.945312 42.998047 L 36.945312 26.892578 L 32.931641 24.634766 z M 8.5371094 31.029297 C 7.5881094 33.593297 7.791875 36.454703 9.171875 38.845703 C 10.562875 41.253703 12.806188 42.975313 15.492188 43.695312 C 16.144188 43.870312 16.803891 43.958859 17.462891 44.005859 L 31.056641 35.929688 L 31.005859 31.314453 L 20.808594 37.355469 C 20.651594 37.448469 20.475828 37.496094 20.298828 37.496094 C 20.129828 37.496094 19.960594 37.452188 19.808594 37.367188 L 8.5371094 31.029297 z"></path>
                        </svg>
                       {loading ?
                       <div className='loader'></div>
                        :
                        <ReactMarkdown>{resultData}</ReactMarkdown>}
                    </div>
                </div>
            }

            <div className='px-6 pt-2 w-full bg-white fixed md:absolute bottom-0'>
                <div className='mb-4 px-6 md:px-8 py-2 md:py-4 bg-gray-300 rounded-full flex items-center'>
                    <input onChange={(e) => setInput(e.target.value)} onKeyDown={input && ((e) => e.key === 'Enter' && handleRequest())} type="text" placeholder='Ask ChatAI' className='w-full outline-0' value={input}/>
                    <button onClick={input && (() => handleRequest())} className='ml-auto cursor-pointer'>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" className='fill-black w-[30px]'>
                            <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0M4.5 7.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5z"/>
                        </svg>
                    </button>
                </div>
                <div className='py-2'>
                    <p className='text-center text-sm text-gray-500'>ChatAI can make mistakes. Check important info.</p>
                </div>
            </div>
        </div>
    );
}

export default Main;